# backend

Rust 製の API/CLI サービス。本番用を見据え、レイヤード構成でドメインと外部 I/O を分離する。

## フォルダ構成
| パス | 役割 |
| --- | --- |
| `src/bin/` | エントリポイント（現状は axum で Hello World を返す） |
| `kernel/` | ドメインモデルとユースケースの中心 |
| `api/` | HTTP/CLI の公開インターフェース層。ハンドラや DTO を配置予定 |
| `adapter/` | DB・キャッシュなど外部システムへの具象実装（リポジトリやクライアント） |
| `registry/` | 依存関係の組み立て。DI 相当の配線や設定の注入 |
| `shared/` | 環境判定などクロスカッティングなユーティリティ |

## レイヤードアーキテクチャ

参考にしているrusty-book-manager同様レイヤードアーキテクチャを採用する。

| 名前 | 概要 |
| --- | --- |
| `api/` | 画面からの入力情報を受け取るレイヤー。axumのルーティング周りを描いている |
| `kernel/` | 受け取った入力情報をアプリケーションが扱いやすいデータ形式に変換しつつ、必要な処理をかける |
| `adapter/` | 永続化層（今回だとPostgresqlとRedis）にアクセスし、データを保存するレイヤー |

レイヤーのルールとして以下3つをおく。

1. 上位レイヤーは、同一レイヤー内、もしくは下位レイヤーのコンポーネントを呼び出して利用する
2. 隣接するレイヤーのコンポーネントしか呼び出さない
3. 下位レイヤーは上位レイヤーのコンポーネントを呼び出さない


## ローカル実行
- `cargo fmt` / `cargo clippy` / `cargo test` を基本の検証コマンド。
- `cargo run --bin app` で開発用 HTTP サーバー起動（ポート 8080、`ENV` でログレベル切り替え）。
- `compose.yaml` で Postgres・Redis と合わせて起動可能（`.env` に各種ポート/認証を設定）。本番向け設定は今後追加。

## 今後のタスク
- adapter 層に Postgres/Redis 実装とマイグレーション手順を追加。
- api 層に Todo のエンドポイントと DTO を整備。
- registry で依存配線をコード化し、テストも追加。
